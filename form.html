<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Evaluación de Registro</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
      background-color: #f4f4f4;
    }
    fieldset {
      margin-bottom: 20px;
      border: 1px solid #ccc;
      padding: 15px;
      background-color: #fff;
    }
    legend {
      font-weight: bold;
      padding: 0 10px;
    }
    label {
      display: block;
      margin-top: 10px;
    }
    input {
      width: 100%;
      padding: 8px;
      margin-top: 4px;
    }
    #result {
      margin-top: 20px;
      font-weight: bold;
    }
    .hidden {
      display: none;
    }
  </style>
</head>
<body>
  <h1>Formulario de Registro</h1>

  <!-- BLOQUE DE LOGIN -->
  <div id="login">
    <label>Contraseña de acceso:
      <input type="password" id="passwordInput">
    </label>
    <button onclick="validarPassword()">Ingresar</button>
  </div>

  <!-- FORMULARIO PRINCIPAL -->
  <div id="formularioContainer" class="hidden">
    <p>Tiempo transcurrido: <span id="cronometro">00:00:00</span></p>
    <form id="registroForm">
      <fieldset>
        <legend>Datos Personales</legend>
        <label>Nombre de usuario: <input type="text" name="nombre"></label>
        <label>Apellido paterno: <input type="text" name="paterno"></label>
        <label>Apellido materno: <input type="text" name="materno"></label>
        <label>Fecha de nacimiento: <input type="date" name="fechaNacimiento"></label>
        <label>Nacionalidad: <input type="text" name="nacionalidad"></label>
      </fieldset>

      <fieldset>
        <legend>Identificación</legend>
        <label>Tipo de ID: <input type="text" name="tipoID"></label>
        <label>Número de identificación: <input type="text" name="numeroID"></label>
        <label>Vigencia de ID: <input type="date" name="vigenciaID"></label>
        <label>País de nacimiento: <input type="text" name="paisNacimiento"></label>
      </fieldset>

      <fieldset>
        <legend>Domicilio</legend>
        <label>Calle: <input type="text" name="calle"></label>
        <label>Número exterior: <input type="text" name="numExt"></label>
        <label>Número interior: <input type="text" name="numInt"></label>
        <label>Código postal: <input type="text" name="cp"></label>
        <label>Colonia: <input type="text" name="colonia"></label>
        <label>Ciudad: <input type="text" name="ciudad"></label>
        <label>Municipio: <input type="text" name="municipio"></label>
        <label>Estado: <input type="text" name="estado"></label>
        <label>País: <input type="text" name="pais"></label>
        <label>Localidad: <input type="text" name="localidad"></label>
      </fieldset>

      <button type="button" onclick="evaluarFormulario()">Finalizar y Generar PDF</button>
    </form>
    <p id="result"></p>
  </div>

  <!-- SCRIPT PRINCIPAL -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script>
    let cronometro = 0;
    let intervalo;

    // Respuestas correctas para evaluación
    const respuestasCorrectas = {
      nombre: "Andrea",
      paterno: "Martínez",
      materno: "López",
      fechaNacimiento: "1997-05-12",
      nacionalidad: "Mexicana",
      tipoID: "Pasaporte",
      numeroID: "X12345678",
      vigenciaID: "2030-08-31",
      paisNacimiento: "México",
      calle: "Av. Reforma",
      numExt: "101",
      numInt: "2B",
      cp: "06030",
      colonia: "Juárez",
      ciudad: "Ciudad de México",
      municipio: "Cuauhtémoc",
      estado: "CDMX",
      pais: "México",
      localidad: "Centro"
    };

    function validarPassword() {
      const pwd = document.getElementById('passwordInput').value;
      if (pwd === "evaluar123") {
        document.getElementById("login").classList.add("hidden");
        document.getElementById("formularioContainer").classList.remove("hidden");
        iniciarCronometro();
      } else {
        alert("Contraseña incorrecta");
      }
    }

    function iniciarCronometro() {
      const cronElem = document.getElementById("cronometro");
      intervalo = setInterval(() => {
        cronometro++;
        let h = String(Math.floor(cronometro / 3600)).padStart(2, '0');
        let m = String(Math.floor((cronometro % 3600) / 60)).padStart(2, '0');
        let s = String(cronometro % 60).padStart(2, '0');
        cronElem.textContent = \`\${h}:\${m}:\${s}\`;
      }, 1000);
    }

    async function evaluarFormulario() {
      clearInterval(intervalo);
      const form = document.getElementById("registroForm");
      const data = new FormData(form);
      let puntaje = 0;
      let totalCampos = 0;

      for (let campo in respuestasCorrectas) {
        totalCampos++;
        const valor = data.get(campo)?.trim().toLowerCase();
        const esperado = respuestasCorrectas[campo].trim().toLowerCase();
        if (valor === esperado) puntaje++;
      }

      document.getElementById("result").textContent = \`Puntaje obtenido: \${puntaje} / \${totalCampos}\`;

      const nombre = prompt("Ingresa el nombre del aspirante para el PDF:");
      if (nombre) {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        doc.setFontSize(12);
        doc.text(\`Aspirante: \${nombre}\`, 10, 10);
        doc.text(\`Fecha y hora: \${new Date().toLocaleString()}\`, 10, 20);
        doc.text(\`Tiempo transcurrido: \${document.getElementById("cronometro").textContent}\`, 10, 30);
        doc.text(\`Puntaje: \${puntaje} / \${totalCampos}\`, 10, 40);

        let y = 50;
        for (let [campo, valor] of data.entries()) {
          doc.text(\`\${campo}: \${valor}\`, 10, y);
          y += 10;
          if (y > 280) {
            doc.addPage();
            y = 10;
          }
        }

        doc.save(\`\${nombre}_evaluacion.pdf\`);
      }
    }
  </script>
</body>
</html>